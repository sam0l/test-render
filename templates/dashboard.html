<!DOCTYPE html>
<html>
<head>
    <title>Vehicle Data Dashboard</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body>
    <div class="container">
        <h1>Vehicle Data Dashboard</h1>

        <!-- GPS Map -->
        <div id="map" style="height: 400px;"></div>
        <script>
            var map = L.map('map').setView([{% if logs %}{{ logs[0][1] }}, {{ logs[0][2] }}{% else %}0, 0{% endif %}], 13);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
            {% for log in logs %}
                L.marker([{{ log[1] }}, {{ log[2] }}]).addTo(map);
            {% endfor %}
        </script>

        <!-- IMU Graph -->
        <canvas id="imuChart" width="400" height="200"></canvas>
        <script>
            var ctx = document.getElementById('imuChart').getContext('2d');
            var imuChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [{% for log in logs %}'{{ log[0] }}',{% endfor %}],
                    datasets: [
                        { label: 'Accel X', data: [{% for log in logs %}{{ log[3] }},{% endfor %}], borderColor: 'red' },
                        { label: 'Accel Y', data: [{% for log in logs %}{{ log[4] }},{% endfor %}], borderColor: 'green' },
                        { label: 'Accel Z', data: [{% for log in logs %}{{ log[5] }},{% endfor %}], borderColor: 'blue' }
                    ]
                }
            });
        </script>

        <!-- Detections -->
        <h2>Recent Detections</h2>
        <div class="row">
            {% for detection in detections %}
                <div class="col-md-4">
                    <img src="/static/images/{{ detection[1] }}" class="img-fluid" alt="{{ detection[2] }}">
                    <p>{{ detection[2] }} (Confidence: {{ detection[3] }})</p>
                </div>
            {% endfor %}
        </div>
    </div>
</body>
</html>